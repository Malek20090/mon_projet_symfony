{# templates/base.html.twig #}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{% block title %}Decide${% endblock %}</title>

    {# ✅ Safe favicon #}
    <link rel="icon"
          href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Ctext y='1.2em' font-size='96'%3E%F0%9F%92%B0%3C/text%3E%3C/svg%3E">

    {# Google Fonts #}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    {# Font Awesome (use ONE version) #}
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          crossorigin="anonymous" referrerpolicy="no-referrer">

    {# Bootstrap CSS (use ONE) #}
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          crossorigin="anonymous">

    {# Your global css #}
    <link rel="stylesheet" href="{{ asset('css/all.min.css') }}">
    <link rel="stylesheet" href="{{ asset('css/style.css') }}">

    {# Optional animate css (since you use wow/fadeIn) #}
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

    {# Page extra styles #}
    {% block stylesheets %}
        <style>
            body { font-family: 'Open Sans', sans-serif; }
            h1, h2, h3, h4, h5 { font-weight: 700; }

            .service-item { background: #fff; box-shadow: 0 0 25px rgba(0,0,0,.08); }
            .service-item:hover { box-shadow: none !important; transform: none !important; background: #fff !important; }
            .service-item:focus, .service-item:focus-within, .service-item:active { outline: none !important; box-shadow: none !important; background: #fff !important; }
            .service-item::before, .service-item::after { content: none !important; display: none !important; }
            .service-item *:focus, .service-item *:active, .service-item *:focus-visible { outline: none !important; box-shadow: none !important; }
            .service-item .btn:focus, .service-item .btn:active, .service-item .btn:focus-visible { outline: none !important; box-shadow: none !important; }

            .bg-breadcrumb { background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%); }
            .footer { background: #0d6efd; }
            .copyright { background: #0a58ca; }
        </style>
    {% endblock %}
</head>

<body class="{% block body_class %}{% endblock %}">

<!-- Navbar -->
<div class="container-fluid position-relative p-0">
    <nav class="navbar navbar-expand-lg navbar-light px-4 px-lg-5 py-3 py-lg-0 bg-white shadow-sm">
        <a href="{{ path('app_salary_expense_index') }}" class="navbar-brand p-0 d-flex align-items-center">
            <i class="fas fa-wallet text-primary me-2" style="font-size: 32px;"></i>
            <h1 class="text-primary m-0 fw-bold">Decide<span class="text-dark">$</span></h1>
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="fa fa-bars"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav ms-auto py-0">
    <a href="{{ path('app_salary_expense_index') }}"
       class="nav-item nav-link {{ app.request.attributes.get('_route') == 'app_salary_expense_index' ? 'active' : '' }}">
        Home
    </a>

    <a href="{{ path('app_revenue_index') }}" class="nav-item nav-link">Revenus</a>
    <a href="{{ path('app_expense_index') }}" class="nav-item nav-link">Dépenses</a>

    {# ✅ SAVINGS LINK #}
    <a href="{{ path('app_savings') }}"
       class="nav-item nav-link {{ app.request.attributes.get('_route') starts with 'app_savings' ? 'active' : '' }}">
        Savings
    </a>

    <a href="{{ path('app_transaction_index') }}" class="nav-item nav-link">Transactions</a>
    <a href="{{ path('app_user_index') }}" class="nav-item nav-link">Users</a>
</div>
            <a href="{{ path('app_register') }}" class="btn btn-primary rounded-pill d-inline-flex flex-shrink-0 py-2 px-4">
                Register
            </a>
        </div>
    </nav>
</div>

{# Page content #}
{% block body %}{% endblock %}

<!-- Footer -->
<div class="container-fluid footer py-5 wow fadeIn" data-wow-delay="0.2s">
    <div class="container py-5">
        <div class="row g-5 mb-5 align-items-center">
            <div class="col-lg-7">
                <div class="position-relative mx-auto">
                    <input class="form-control rounded-pill w-100 py-3 ps-4 pe-5" type="email" placeholder="Enter your email to receive financial tips">
                    <button type="button" class="btn btn-secondary rounded-pill position-absolute top-0 end-0 py-2 px-4 mt-2 me-2">Subscribe</button>
                </div>
            </div>
            <div class="col-lg-5">
                <div class="d-flex align-items-center justify-content-center justify-content-lg-end">
                    <a class="btn btn-secondary btn-md-square rounded-circle me-3" href="#"><i class="fab fa-linkedin-in"></i></a>
                    <a class="btn btn-secondary btn-md-square rounded-circle me-3" href="#"><i class="fab fa-github"></i></a>
                    <a class="btn btn-secondary btn-md-square rounded-circle me-3" href="#"><i class="fab fa-twitter"></i></a>
                    <a class="btn btn-secondary btn-md-square rounded-circle me-0" href="#"><i class="fas fa-envelope"></i></a>
                </div>
            </div>
        </div>

        <div class="row g-5">
            <div class="col-md-6 col-lg-6 col-xl-3">
                <div class="footer-item d-flex flex-column">
                    <h3 class="text-white mb-4"><i class="fas fa-chart-line text-primary me-3"></i>Decide$</h3>
                    <p class="mb-3 text-white-50">
                        Decide$ is a smart financial management platform designed to help users track salaries, control expenses,
                        build savings, and make informed financial decisions.
                    </p>
                </div>
            </div>

            <div class="col-md-6 col-lg-6 col-xl-3">
                <div class="footer-item d-flex flex-column">
                    <h4 class="text-white mb-4">Platform</h4>
                    <a href="{{ path('app_revenue_index') }}" class="text-white-50 text-decoration-none mb-2"><i class="fas fa-angle-right me-2"></i> Salary Management</a>
                    <a href="{{ path('app_expense_index') }}" class="text-white-50 text-decoration-none mb-2"><i class="fas fa-angle-right me-2"></i> Expense Tracking</a>
                    <a href="#" class="text-white-50 text-decoration-none mb-2"><i class="fas fa-angle-right me-2"></i> Savings Goals</a>
                    <a href="#" class="text-white-50 text-decoration-none mb-2"><i class="fas fa-angle-right me-2"></i> Financial Dashboard</a>
                </div>
            </div>

            <div class="col-md-6 col-lg-6 col-xl-3">
                <div class="footer-item d-flex flex-column">
                    <h4 class="text-white mb-4">Key Features</h4>
                    <p class="text-white mb-2">✔ Monthly Salary Tracking</p>
                    <p class="text-white mb-2">✔ Budget Planning</p>
                    <p class="text-white mb-2">✔ Expense Categorization</p>
                    <p class="text-white mb-2">✔ Financial Security Alerts</p>
                </div>
            </div>

            <div class="col-md-6 col-lg-6 col-xl-3">
                <div class="footer-item d-flex flex-column">
                    <h4 class="text-white mb-4">Contact</h4>
                    <a href="#" class="text-white-50 text-decoration-none mb-2"><i class="fas fa-user me-2"></i> Project Team – Decide$</a>
                    <a href="mailto:support@decides.com" class="text-white-50 text-decoration-none mb-2"><i class="fas fa-envelope me-2"></i> support@decides.com</a>
                    <a href="#" class="text-white-50 text-decoration-none mb-2"><i class="fas fa-university me-2"></i> Academic Project</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Copyright -->
<div class="container-fluid copyright py-4">
    <div class="container">
        <div class="row g-4 align-items-center">
            <div class="col-md-6 text-center text-md-start mb-md-0">
                <span class="text-white-50"><i class="fas fa-copyright text-light me-2"></i>Decide$, All right reserved.</span>
            </div>
            <div class="col-md-6 text-center text-md-end text-white-50">
                Designed By <strong class="text-white">Decides Team</strong>
            </div>
        </div>
    </div>
</div>

{# ✅ Bootstrap JS (one) #}
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

{# WOW JS (optional) #}
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        if (typeof WOW !== 'undefined') { new WOW().init(); }
    });
</script>

{# ✅ Symfony importmap and page scripts #}
{% block javascripts %}
    {{ importmap('app') }}

    <script>
      /* ============================
         GLOBAL AJAX FORM HANDLER
         ============================ */

      function showServerToast(type, title, message) {
        let box = document.getElementById("server-toast-box");
        if (!box) {
          box = document.createElement("div");
          box.id = "server-toast-box";
          box.style.position = "fixed";
          box.style.top = "20px";
          box.style.right = "20px";
          box.style.zIndex = "9999";
          document.body.appendChild(box);
        }

        const t = document.createElement("div");
        t.style.marginBottom = "10px";
        t.style.padding = "14px 16px";
        t.style.borderRadius = "12px";
        t.style.background = type === "success" ? "#e6fff5" : "#fff1f1";
        t.style.border = type === "success" ? "1px solid #4cd964" : "1px solid #ff5c5c";
        t.innerHTML = `<strong>${title}</strong><br>${message}`;
        box.appendChild(t);

        setTimeout(() => t.remove(), 4000);
      }

      async function submitAjax(form) {
        const fd = new FormData(form);

        let res;
        try {
          res = await fetch(form.action, {
            method: form.method || "POST",
            body: fd,
            headers: { "X-Requested-With": "XMLHttpRequest" },
            credentials: "same-origin"
          });
        } catch {
          showServerToast("danger", "Connexion au serveur", "Serveur inaccessible.");
          return;
        }

        const ct = (res.headers.get("content-type") || "").toLowerCase();

        // ✅ JSON => normal
        if (ct.includes("application/json")) {
          let data = null;
          try { data = await res.json(); } catch { data = null; }

          if (!res.ok || (data && data.ok === false)) {
            const msg = (data && (data.message || (data.errors || []).join(" "))) || "Erreur.";
            showServerToast("danger", "Erreur", msg);
            return;
          }

          showServerToast("success", "Succès", (data && data.message) || "Action réussie.");
          window.location.reload();
          return;
        }

        // ✅ HTML / redirect => normal Symfony (flash + redirect)
        if (res.redirected || ct.includes("text/html")) {
          window.location.reload();
          return;
        }

        showServerToast("danger", "Connexion au serveur", "Réponse inattendue.");
      }

      document.addEventListener("submit", function (e) {
        const form = e.target;
        if (!(form instanceof HTMLFormElement)) return;
        if (form.dataset.ajax !== "1") return;

        e.preventDefault();
        submitAjax(form);
      }, true);
    </script>
{% endblock %}
